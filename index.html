<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026 å°¾ç‰™åˆ‡æ°´æœå¤§è³½</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #1a1a1a; touch-action: none; font-family: 'Microsoft JhengHei', sans-serif; }
        canvas { display: block; }
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 100; overflow-y: auto; padding: 20px; }
        .avatar-option { width: 60px; height: 60px; border: 3px solid transparent; border-radius: 50%; cursor: pointer; transition: 0.2s; font-size: 40px; display: flex; align-items: center; justify-content: center; background: #333; }
        .avatar-selected { border-color: #fbbf24; background: #555; transform: scale(1.1); }
        #screenshot-area { background: linear-gradient(135deg, #1e3a8a, #1e40af); padding: 30px; border-radius: 20px; text-align: center; color: white; border: 4px solid #fbbf24; }
    </style>
</head>
<body>

    <div id="login-menu" class="overlay text-white">
        <h1 class="text-3xl font-black text-yellow-500 mb-4 italic">2026 å°¾ç‰™äº’å‹•éŠæˆ²</h1>
        
        <div class="w-full max-w-xs space-y-4">
            <div>
                <label class="block text-sm mb-1 text-gray-400">å“¡å·¥ç·¨è™Ÿ / å¸³è™Ÿ</label>
                <input type="text" id="userId" placeholder="ä¾‹å¦‚: A123" class="w-full p-2 rounded bg-gray-800 border border-gray-600 text-center">
            </div>
            <div>
                <label class="block text-sm mb-1 text-gray-400">éŠæˆ²æš±ç¨±</label>
                <input type="text" id="pName" placeholder="æƒ³å«ä»€éº¼å‘¢ï¼Ÿ" class="w-full p-2 rounded bg-gray-800 border border-gray-600 text-center">
            </div>
            
            <label class="block text-sm mb-1 text-gray-400 text-center">é¸æ“‡é ­åƒ</label>
            <div id="avatar-list" class="grid grid-cols-4 gap-3 justify-items-center">
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘¨â€ğŸ’¼', this)">ğŸ‘¨â€ğŸ’¼</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘¨â€ğŸ¨', this)">ğŸ‘¨â€ğŸ¨</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘¨â€ğŸš€', this)">ğŸ‘¨â€ğŸš€</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘¨â€ğŸš’', this)">ğŸ‘¨â€ğŸš’</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘©â€ğŸ’¼', this)">ğŸ‘©â€ğŸ’¼</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘©â€ğŸ”¬', this)">ğŸ‘©â€ğŸ”¬</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘©â€ğŸ¨', this)">ğŸ‘©â€ğŸ¨</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ‘©â€ğŸš’', this)">ğŸ‘©â€ğŸš’</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ¶', this)">ğŸ¶</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ±', this)">ğŸ±</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ¦Š', this)">ğŸ¦Š</div>
                <div class="avatar-option" onclick="selectAvatar('ğŸ¦', this)">ğŸ¦</div>
            </div>
        </div>

        <button onclick="checkStartTime()" class="mt-8 bg-yellow-600 hover:bg-yellow-500 text-white px-10 py-3 rounded-full text-xl font-bold shadow-lg w-64">é€²å…¥å¤§è³½</button>
    </div>

    <div id="result-screen" class="overlay text-white hidden">
        <div id="screenshot-area">
            <div id="res-avatar" class="text-64px mb-2" style="font-size: 80px;">ğŸ¶</div>
            <h2 id="res-name" class="text-2xl font-bold">æš±ç¨±</h2>
            <p id="res-id" class="text-sm opacity-70">å¸³è™Ÿ: A123</p>
            <div class="my-6">
                <p class="text-gray-300">æœ€çµ‚å¾—åˆ†</p>
                <p id="res-score" class="text-6xl font-black text-yellow-400">0</p>
            </div>
            <p id="res-time" class="text-xs text-gray-400">å®Œæˆæ™‚é–“: 2026/01/05 19:00</p>
        </div>
        <button onclick="downloadResult()" class="mt-6 bg-green-600 px-8 py-2 rounded-lg font-bold">â¬‡ ä¸‹è¼‰æˆç¸¾æˆªåœ–</button>
        <button onclick="location.reload()" class="mt-2 text-gray-400 underline">è¿”å›ä¸»é¸å–®</button>
    </div>

    <div id="ui" class="absolute top-0 w-full p-4 text-white text-2xl font-bold flex justify-between pointer-events-none">
        <div id="liveScore">åˆ†æ•¸: 0</div>
        <div id="liveLife" class="text-red-500">â¤â¤â¤</div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // --- ç®¡ç†è€…è¨­å®š ---
        const DEADLINE = new Date("2026-01-05T19:30:00"); // æˆªæ­¢æ™‚é–“

        let selectedAvatar = "ğŸ¶";
        let score = 0, lives = 3, gameActive = false;
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let fruits = [], trail = [];

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        function selectAvatar(emoji, el) {
            document.querySelectorAll('.avatar-option').forEach(opt => opt.classList.remove('avatar-selected'));
            el.classList.add('avatar-selected');
            selectedAvatar = emoji;
        }

        function checkStartTime() {
            const now = new Date();
            if (now > DEADLINE) {
                alert("æ´»å‹•å·²çµæŸï¼æˆç¸¾ä¸å†åˆ—å…¥ç´€éŒ„å–”ã€‚");
                // ä¾ç„¶å¯ä»¥ç©ï¼Œä½†æœ€å¾Œ saveScore æœƒè¢«æ“‹æ‰
            }
            const uid = document.getElementById('userId').value;
            const name = document.getElementById('pName').value;
            if(!uid || !name) { alert("è«‹è¼¸å…¥å¸³è™Ÿèˆ‡æš±ç¨±ï¼"); return; }
            
            document.getElementById('login-menu').style.display = 'none';
            gameActive = true;
            loop();
        }

        // --- æ ¸å¿ƒéŠæˆ²é‚è¼¯ (ç°¡åŒ–ç‰ˆ) ---
        class Fruit {
            constructor() {
                this.x = Math.random() * (canvas.width - 60) + 30;
                this.y = canvas.height + 20;
                this.vx = (Math.random() - 0.5) * 8;
                this.vy = -(Math.random() * 5 + 14);
                this.emoji = ['ğŸ', 'ğŸ‰', 'ğŸ', 'ğŸ¥'][Math.floor(Math.random()*4)];
                this.radius = 30;
                this.sliced = false;
            }
            update() { this.vy += 0.25; this.x += this.vx; this.y += this.vy; }
            draw() { ctx.font="50px Arial"; ctx.fillText(this.emoji, this.x-25, this.y+20); }
        }

        function loop() {
            if (!gameActive) return;
            ctx.fillStyle = 'rgba(26,26,26,0.6)';
            ctx.fillRect(0,0,canvas.width, canvas.height);
            
            if(Math.random() < 0.04) fruits.push(new Fruit());
            
            fruits.forEach((f, i) => {
                f.update(); f.draw();
                if(f.y > canvas.height + 50) { 
                    if(!f.sliced) { lives--; updateHeart(); }
                    fruits.splice(i, 1); 
                }
            });

            if(lives <= 0) showResult();
            else requestAnimationFrame(loop);
        }

        function updateHeart() { document.getElementById('liveLife').innerText = "â¤".repeat(Math.max(0,lives)); }

        window.addEventListener('touchmove', (e) => {
            const x = e.touches[0].clientX;
            const y = e.touches[0].clientY;
            fruits.forEach(f => {
                if(!f.sliced && Math.hypot(f.x-x, f.y-y) < 40) {
                    f.sliced = true; score += 10;
                    document.getElementById('liveScore').innerText = `åˆ†æ•¸: ${score}`;
                }
            });
        });

        // --- çµæŸèˆ‡æˆªåœ– ---
        function showResult() {
            gameActive = false;
            const now = new Date();
            document.getElementById('res-avatar').innerText = selectedAvatar;
            document.getElementById('res-name').innerText = document.getElementById('pName').value;
            document.getElementById('res-id').innerText = "å¸³è™Ÿ: " + document.getElementById('userId').value;
            document.getElementById('res-score').innerText = score;
            document.getElementById('res-time').innerText = "å®Œæˆæ™‚é–“: " + now.toLocaleString();
            document.getElementById('result-screen').classList.remove('hidden');

            // å¦‚æœåœ¨æ™‚é–“å…§ï¼Œä¸Šå‚³åˆ†æ•¸åˆ° Firebase (æ­¤è™•å¾…ä¸²æ¥)
            if (now <= DEADLINE) {
                console.log("ä¸Šå‚³åˆ†æ•¸è‡³ä¼ºæœå™¨...");
                // uploadScoreToServer(uid, name, selectedAvatar, score);
            }
        }

        function downloadResult() {
            html2canvas(document.querySelector("#screenshot-area")).then(canvas => {
                const link = document.createElement('a');
                link.download = `TailEvent_Score_${score}.png`;
                link.href = canvas.toDataURL();
                link.click();
            });
        }
    </script>
</body>
</html>
